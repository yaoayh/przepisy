if (self.CavalryLogger) { CavalryLogger.start_js(["i1iPa"]); }

__d("TimeSliceImpl",["invariant","CircularBuffer","Env","ErrorGuard","FBLogger","IntervalTrackingBoundedBuffer","WorkerUtils","getReusableTimeSliceContinuation","nullthrows","performanceAbsoluteNow","wrapFunction"],(function(a,b,c,d,e,f,g){var h,i,j,k,l=[],m=[],n="key"+Math.random(),o=1,p=!1,q=0,r=1,s=2,t={},u=q,v=new(b("CircularBuffer"))(100),w=0,x=0;c=(h||(h=b("Env"))).timesliceBufferSize;c==null&&(c=5e3);var y=new(b("IntervalTrackingBoundedBuffer"))(c),z="stackTraceLimit"in Error,A=[],B=[],C=[];function D(){return E(A)}function E(a){return a.length>0?a[a.length-1]:null}function F(a,c){var d={};(i||(i=b("ErrorGuard"))).applyWithGuard(J,null,[a,c,d]);i.applyWithGuard(K,null,[a,c,d]);A.push(a);B.push(c);C.push(d)}function G(a,b,c){l.forEach(function(d){var e=d.onNewContextCreated(D(),b,c);a[d.getBeforeID()]=e})}function H(a,b){l.forEach(function(c){c.onContextCanceled(a,b[c.getBeforeID()])})}function I(a,b,c){m.forEach(function(d){d.onAfterContextEnded(a,b[d.getBeforeID()],c[d.getBeforeID()],a.meta)})}function J(a,b,c){l.forEach(function(d){var e=d.onBeforeContextStarted(a,b[d.getBeforeID()],a.meta);c[d.getBeforeID()]=e})}function K(a,b,c){l.forEach(function(d){var e=d.onAfterContextStarted(a,b[d.getBeforeID()],c[d.getBeforeID()],a.meta);c[d.getBeforeID()]=e})}function L(){var a=D(),c=E(B),d=E(C);if(a==null||c==null||d==null){b("FBLogger")("TimeSlice").mustfix("popped too many times off the timeslice stack");p=!1;return}(i||(i=b("ErrorGuard"))).applyWithGuard(I,null,[a,c,d]);p=!a.isRoot;A.pop();B.pop();C.pop()}var M={PropagationType:{CONTINUATION:0,EXECUTION:1,ORPHAN:2},guard:function(a,c,d){var e;typeof a==="function"||g(0,3725);typeof c==="string"||g(0,3726);var f=N(d);if(a[n])return a;f.root||M.checkCoverage();var l;p&&(l=D());var m={},q=0,r=void 0;e=(e=(h||(h=b("Env"))).deferred_stack_trace_rate)!=null?e:0;d&&d.registerCallStack&&e>0&&Math.random()<1/e&&(r=new Error("deferred execution source"));var s={cancel:function(){s.invoked||(i||(i=b("ErrorGuard"))).applyWithGuard(H,null,[c,m])},tokens:[],invoked:!1};d=function(){var d=(j||(j=b("performanceAbsoluteNow")))(),e=o++,g={contextID:e,name:c,isRoot:!p,executionNumber:q++,meta:f,absBeginTimeMs:d};s.invoked||(s.invoked=!0,s.tokens.length&&(s.tokens.forEach(function(a){delete t[a]}),s.tokens=[]));F(g,m);if(l!=null){var h=!!f.isContinuation;l.isRoot?(g.indirectParentID=l.contextID,g.isEdgeContinuation=h):(g.indirectParentID=l.indirectParentID,g.isEdgeContinuation=!!(h&&l.isEdgeContinuation))}var n=(k||(k=b("WorkerUtils"))).isWorkerContext();p=!0;try{for(var u=arguments.length,v=new Array(u),w=0;w<u;w++)v[w]=arguments[w];if(!g.isRoot||n)return a.apply(this,v);else return(i||(i=b("ErrorGuard"))).applyWithGuard(a,this,v,{name:"TimeSlice"+(c?": "+c:""),deferredSource:r})}finally{var z=D();if(z==null)b("FBLogger")("TimeSlice").mustfix("timeslice stack misaligned, not logging the block"),p=!1;else{var A=z.isRoot,B=z.contextID,C=z.indirectParentID,E=z.isEdgeContinuation,G=(j||(j=b("performanceAbsoluteNow")))();z.absEndTimeMs=G;if(A&&d!=null){x+=G-d;var H=babelHelpers["extends"]({begin:d,end:G,id:B,indirectParentID:C,representsExecution:!0,isEdgeContinuation:l&&E,guard:c},f,a.__SMmeta);y.pushElement(H)}L()}}};d[n]=s;(i||(i=b("ErrorGuard"))).applyWithGuard(G,null,[m,c,f]);return d},copyGuardForWrapper:function(a,b){a&&a[n]&&(b[n]=a[n]);return b},cancel:function(a){a=a?a[n]:null;a&&!a.invoked&&(a.cancel(),a.tokens.forEach(function(a){delete t[a]}),a.invoked=!0)},cancelWithToken:function(a){t[a]&&M.cancel(t[a])},registerForCancelling:function(a,b){a&&(b[n]&&(t[a]||(b[n].invoked||(t[a]=b,b[n].tokens.push(a)))))},inGuard:function(){return p},checkCoverage:function(){var a;if(u!==s&&!p){z&&(a=Error.stackTraceLimit,Error.stackTraceLimit=50);var c=new Error("Missing TimeSlice coverage");z&&(Error.stackTraceLimit=a);u===r&&Math.random()<w?b("FBLogger")("TimeSlice").catching(c).debug("Missing TimeSlice coverage"):u===q&&b("nullthrows")(v).write(c)}},setLogging:function(a,c){if(u!==q)return;w=c;a?(u=r,b("nullthrows")(v).read().forEach(function(a){Math.random()<w&&b("FBLogger")("TimeSlice").catching(a).warn("error from logging buffer")})):u=s;b("nullthrows")(v).clear();v=void 0},getContext:function(){return D()},getTotalTime:function(){return x},getGuardedContinuation:function(a){function b(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return a.apply(this,c)}return M.guard(b,a,{propagationType:M.PropagationType.CONTINUATION})},getReusableContinuation:function(a){return b("getReusableTimeSliceContinuation")(M,n,a)},getPlaceholderReusableContinuation:function(){var a=function(a){return a()};a.last=a;return a},getGuardNameStack:function(){return A.map(function(a){return a.name})},registerExecutionContextObserver:function(a){var b=!1;for(var c=0;c<l.length;c++)if(l[c].getBeforeID()>a.getBeforeID()){l.splice(c,0,a);b=!0;break}b||l.push(a);for(var c=0;c<m.length;c++)if(m[c].getAfterID()>a.getAfterID()){m.splice(c,0,a);return}m.push(a)},catchUpOnDemandExecutionContextObservers:function(a){for(var b=0;b<A.length;b++){var c=A[b],d=B[b],e=C[b]||{};d=a.onBeforeContextStartedWhileEnabled(c,d[a.getBeforeID()],c.meta);e[a.getBeforeID()]=d;C[b]=e}},getBuffer:function(){return y}};function N(a){var b={};a&&a.propagateCounterAttribution!==void 0&&(b.propagateCounterAttribution=a.propagateCounterAttribution);a&&a.root!==void 0&&(b.root=a.root);switch(a&&a.propagationType){case M.PropagationType.CONTINUATION:b.isContinuation=!0;b.extendsExecution=!0;break;case M.PropagationType.ORPHAN:b.isContinuation=!1;b.extendsExecution=!1;break;case M.PropagationType.EXECUTION:default:b.isContinuation=!1,b.extendsExecution=!0}return b}b("wrapFunction").setWrapper(function(a,b){return M.guard(a,b,{registerCallStack:!0})},"entry");a.TimeSlice=M;e.exports=M}),6);